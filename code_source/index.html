<!DOCTYPE html>
<html>
  <head>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"
    />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-face-aframe.prod.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.1/howler.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <!-- Find nice fonts and icons on Google Fonts-->
    <link
      href="https://fonts.googleapis.com/css2?family=Rosarivo:ital@0;1&display=swap"
      rel="stylesheet"
    />
    <script type="module" crossorigin src="./index.js"></script>
    <link rel="stylesheet" href="./index.css" />
    <style>
      /* Add this inside your head section */
      .clickable {
        cursor: pointer;
      }
      .clickable:hover {
        transform: scale(1.1);
      }
    </style>
    <script>
      let bgMusic;

      // Initialize background music
      function initializeAudio() {
        // Hide audio controls by default
        const audioControls = document.getElementById('audio-controls');
        if (audioControls) {
          audioControls.style.display = 'none';
        }

        // Check if audio file exists before initializing
        fetch('./assets/audio/background-music.mp3', { method: 'HEAD' })
          .then(response => {
            if (response.ok) {
              try {
                bgMusic = new Howl({
                  src: ['./assets/audio/background-music.mp3'],
                  loop: true,
                  volume: 0.5,
                  autoplay: false,
                  onload: function() {
                    console.log('Audio loaded successfully');
                    if (audioControls) {
                      audioControls.style.display = 'block';
                    }
                  },
                  onloaderror: function(id, error) {
                    console.error('Audio loading error:', error);
                  }
                });
              } catch (error) {
                console.error('Audio initialization failed:', error);
              }
            } else {
              console.error('Background music file not found');
            }
          })
          .catch(error => {
            console.error('Error checking audio file:', error);
          });
      }

      // Audio control component
      AFRAME.registerComponent('audio-controller', {
        init: function() {
          // Initialize audio when component loads
          initializeAudio();

          // Play music when target is found
          this.el.addEventListener('targetFound', () => {
            if (bgMusic && !bgMusic.playing()) {
              bgMusic.play();
            }
          });

          // Optional: Pause music when target is lost
          this.el.addEventListener('targetLost', () => {
            if (bgMusic && bgMusic.playing()) {
              bgMusic.fade(0.5, 0, 1000);
              setTimeout(() => bgMusic.pause(), 1000);
            }
          });
        }
      });

      // Add this inside your head section
      AFRAME.registerComponent('clickable', {
        init: function() {
          // Add cursor hover visual feedback
          this.el.addEventListener('mouseenter', () => {
            this.el.setAttribute('scale', '1.2 1.2 1.2');
          });
          
          this.el.addEventListener('mouseleave', () => {
            this.el.setAttribute('scale', '1 1 1');
          });

          // Handle both touch and mouse interactions
          this.el.addEventListener('click', (evt) => {
            console.log('Clicked/Touched!');
            const url = this.el.getAttribute('link-url');
            const type = this.el.getAttribute('link-type');
            
            if (type === 'url') {
              window.open(url, '_blank');
            } else if (type === 'email') {
              window.location.href = url;
            }
          });
        }
      });

      // Add delayed appearance component
      AFRAME.registerComponent('delayed-appearance', {
        init: function() {
          // Start with the element hidden
          this.el.setAttribute('visible', false);
          
          // After 2 seconds, make it visible and start the fade in
          setTimeout(() => {
            this.el.setAttribute('visible', true);
            this.el.setAttribute('animation__fade', {
              property: 'opacity',
              from: 0,
              to: 1,
              dur: 1000,
              easing: 'easeInOutQuad'
            });
          }, 2000);
        }
      });
    </script>
    <title>Business Card</title>
  </head>
  <body>
    <div id="ar-display">
      <!-- Add audio controls -->
      <div id="audio-controls" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
        <button onclick="toggleMusic()" style="padding: 10px; border-radius: 50%; background: rgba(255,255,255,0.7); border: none; cursor: pointer;">
          ðŸ”Š
        </button>
      </div>
      <!-- Real video that gets displayed on screen.
       This canvas forwards MindAR's video stream from a static <video> element that is dynamically controlled by MindAR. -->
      <canvas id="video-canvas"></canvas>
      <!-- If we only use the original a-canvas from MindAR,
        we will not be able to control the rendering logic of the 3D models attached to the scene.
        Here, whatever being rendered on ar-effect-canvas will overlay on top of the MindAR effects.
        With this, we can achieve the transition from an image-tracked object to a freely-floating object.-->
      <canvas id="ar-effect-canvas"></canvas>
    </div>
    <div id="ar-scene">
      <!-- Add any of your customized UIs. Note that this will cover the original scene.-->
    </div>
    <script>
      // Add music control function
      function toggleMusic() {
        if (!bgMusic) return;
        
        const button = document.querySelector('#audio-controls button');
        if (bgMusic.playing()) {
          bgMusic.fade(0.5, 0, 500);
          setTimeout(() => bgMusic.pause(), 500);
          button.textContent = 'ðŸ”ˆ';
        } else {
          bgMusic.fade(0, 0.5, 500);
          bgMusic.play();
          button.textContent = 'ðŸ”Š';
        }
      }
    </script>
  </body>
</html>
